<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ÙƒØ´Ù Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©</title>

<style>
  :root{--brand:#0f5c6e;}
  body{font-family:Tahoma,Arial,sans-serif;background:#f7f7f7;padding:20px;margin:0}

  .card{
    max-width:1000px;
    margin:0 auto;
    background:#fff;
    border-radius:14px;
    box-shadow:0 10px 30px rgba(0,0,0,.08);
    padding:18px;
    position:relative;
    overflow:hidden;
  }

  /* ===== Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ø§Ø¦ÙŠØ© (Ø§Ù„Ù„ÙˆØ¬Ùˆ) ===== */
  .card::before{
    content:"";
    position:absolute;
    inset:0;
    background-image:url("logo.png"); /* Ø§Ø³Ù… Ù…Ù„Ù Ø§Ù„Ù„ÙˆØ¬Ùˆ */
    background-repeat:no-repeat;
    background-position:center;
    background-size:320px;
    opacity:0.06;
    pointer-events:none;
    z-index:0;
  }

  /* Ø§Ø¬Ø¹Ù„ ÙƒÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ÙÙˆÙ‚ Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ø§Ø¦ÙŠØ© */
  .card > *{position:relative;z-index:1}

  h2{text-align:center;margin:0 0 12px}

  .row{
    display:flex;
    gap:12px;
    flex-wrap:wrap;
    align-items:center;
    justify-content:center
  }

  input[type="text"]{
    padding:12px 14px;
    min-width:280px;
    border:1px solid #ddd;
    border-radius:10px;
    font-size:16px;
    outline:none
  }

  input[type="text"]:focus{
    border-color:var(--brand);
    box-shadow:0 0 0 3px rgba(15,92,110,.15)
  }

  .note{text-align:center;color:#666;margin-top:10px}
  .pill{
    display:inline-block;
    background:rgba(15,92,110,.08);
    color:var(--brand);
    padding:6px 10px;
    border-radius:999px;
    font-size:13px
  }

  table{
    width:100%;
    border-collapse:collapse;
    margin-top:14px;
    background:#fff
  }

  th,td{
    border:1px solid #e2e2e2;
    padding:10px;
    text-align:right;
    vertical-align:top
  }

  th{
    background:var(--brand);
    color:#fff;
    position:sticky;
    top:0
  }

  tr:nth-child(even){background:#fafafa}

  .actions{
    display:flex;
    gap:8px;
    justify-content:center;
    margin-top:10px;
    flex-wrap:wrap
  }

  button{
    border:0;
    border-radius:10px;
    padding:10px 14px;
    cursor:pointer;
    font-size:14px
  }

  .btn2{background:#eee}
  .small{text-align:center;font-size:12px;color:#777;margin-top:8px}
  .hidden{display:none}

  /* ===== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© ===== */
  @media print{
    body{background:#fff;padding:0}
    .card{
      box-shadow:none;
      border-radius:0;
      max-width:none;
      padding:0
    }
    .row,.actions,.small{display:none !important}
    th{position:static}
    .card::before{
      opacity:0.08;
      background-size:380px
    }
    @page{margin:12mm}
  }
</style>
</head>

<body>

<div class="card">
  <h2>ğŸ” Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©</h2>

  <div class="row">
    <input id="search" type="text" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ø¦Ù„Ø© (Ù…Ø«Ø§Ù„: Ø§Ù„Ø¹Ù„ÙŠ)" autocomplete="off">
  </div>

  <div class="note" id="info">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>

  <div class="actions">
    <button class="btn2" id="clearBtn">Ù…Ø³Ø­ Ø§Ù„Ø¨Ø­Ø«</button>
    <button class="btn2" id="printBtn">Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
  </div>

  <table id="table" class="hidden">
    <thead></thead>
    <tbody></tbody>
  </table>

  <div class="small">
    Ù…Ù„Ø§Ø­Ø¸Ø©: Ø§Ù„Ù…Ù„Ù ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ ÙˆÙ„Ø§ ÙŠØ­ØªØ§Ø¬ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ø±ÙØ¹Ù‡.
  </div>
</div>

<script>
let data=[], headers=[], FAMILY_COL=null;
const info=document.getElementById("info");
const table=document.getElementById("table");
const thead=table.querySelector("thead");
const tbody=table.querySelector("tbody");
const searchInput=document.getElementById("search");

const norm=s=>(s??"").toString().replace(/[\u064B-\u0652]/g,"").trim().replace(/\s+/g," ").toLowerCase();

function parseCSV(text){
  const lines=text.replace(/\r/g,"").trim().split("\n").filter(l=>l.trim());
  if(!lines.length) return {headers:[],rows:[]};
  const sep=(lines[0].match(/;/g)||[]).length>(lines[0].match(/,/g)||[]).length?";":",";
  headers=lines[0].split(sep).map(h=>h.trim());
  const rows=[];
  for(let i=1;i<lines.length;i++){
    const cols=lines[i].split(sep);
    const o={};
    headers.forEach((h,j)=>o[h]=(cols[j]??"").trim());
    rows.push(o);
  }
  return {headers,rows};
}

function detectFamilyColumn(){
  const cands=["Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©","Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©","Ø§Ù„Ø¹Ø§Ø¦Ù„Ù‡","Family","family","LastName","surname"];
  return headers.find(h=>cands.includes(h))||headers.find(h=>h.includes("Ø¹Ø§Ø¦Ù„"))||null;
}

function render(rows){
  if(!rows.length){table.classList.add("hidden");return;}
  thead.innerHTML="<tr>"+headers.map(h=>`<th>${h}</th>`).join("")+"</tr>";
  tbody.innerHTML=rows.map(r=>"<tr>"+headers.map(h=>`<td>${r[h]??""}</td>`).join("")+"</tr>").join("");
  table.classList.remove("hidden");
}

function search(){
  const q=norm(searchInput.value);
  if(!data.length||!FAMILY_COL){render([]);return;}
  if(!q){info.textContent="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ø¦Ù„Ø© Ù„Ù„Ø¨Ø­Ø«";render([]);return;}
  const res=data.filter(r=>norm(r[FAMILY_COL]).includes(q));
  info.textContent=res.length?`Ø¹Ø¯Ø¯ Ø§Ù„Ù†ØªØ§Ø¦Ø¬: ${res.length}`:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬";
  render(res);
}

fetch("families.csv?v="+Date.now())
.then(r=>r.text())
.then(t=>{
  const p=parseCSV(t);
  data=p.rows;
  FAMILY_COL=detectFamilyColumn();
  search();
})
.catch(()=>info.textContent="ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");

searchInput.addEventListener("input",search);
document.getElementById("clearBtn").onclick=()=>{searchInput.value="";search();}
document.getElementById("printBtn").onclick=()=>window.print();
</script>

</body>
</html>
